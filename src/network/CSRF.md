### CSRF

Cross Site Request Forgery

인터넷 사용자가 자신의 의지와 무관하게 공격자가 의도한 행위를 특정 웹사이트에 공격하게 만드는 것

1. 사용자는 보안이 취약한 서버에 로그인합니다.

2. 서버에 저장된 세션 정보를 사용할 수 있는 session ID가 사용자의 브라우저 쿠키에 저장됩니다.

3. 공격자는 사용자가 악성 스크립트 페이지를 누르도록 유도합니다.

악성 스크립트 페이지를 누르도록 유도하는 방식은 아래와 같은 방식들이 있습니다.

- 게시판이 있는 웹사이트에 악성 스크립트를 게시글로 작성하여 사용자들이 게시글을 클릭하도록 유도
- 메일 등으로 악성 스크립트를 직접 전달하거나, 악성 스크립트가 적힌 페이지 링크를 전달

4. 사용자가 악성 스크립트가 작성된 페이지 접근시 웹 브라우저에 의해 쿠키에 저장된 session ID와 함께 서버로 요청됩니다.

5. 서버는 쿠키에 담긴 session ID를 통해 해당 요청이 인증된 사용자로부터 온 것으로 판단하고 처리합니다.

스프링 시큐리티에서는 CSRF 토큰을 사용하여 모든 요청마다 해당 값을 포함하여 전송하도록 한다

서버에서 요청을 받을때마다 세션에 저장된 값과 요청으로 전송된 값이 일치하는지 검증하여 방어한다.

그래서 이렇게 보안 수준을 향상시키는 CSRF를 왜 disable 하였을까? spring security documentation에 non-browser clients 만을 위한 서비스라면 csrf를 disable 하여도 좋다고 한다.

!https://velog.velcdn.com/images%2Fwoohobi%2Fpost%2Fbb399e9a-7f87-4f00-8b14-3f29bb239b6e%2Fimage.png

이 이유는 rest api를 이용한 서버라면, session 기반 인증과는 다르게 stateless하기 때문에 서버에 인증정보를 보관하지 않는다. rest api에서 client는 권한이 필요한 요청을 하기 위해서는 요청에 필요한 인증 정보를(OAuth2, jwt토큰 등)을 포함시켜야 한다. 따라서 서버에 인증정보를 저장하지 않기 때문에 굳이 불필요한 csrf 코드들을 작성할 필요가 없다.